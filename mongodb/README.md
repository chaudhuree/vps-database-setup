![mongoDB](https://upload.wikimedia.org/wikipedia/en/5/5a/MongoDB_Fores-Green.svg)

## **Ubuntu VPS-ржП MongoDB Setup, User Management, ржПржмржВ Firewall Configuration (Step-by-Step)**

---

ржПржЗ ржЧрж╛ржЗржбрзЗ ржЖржорж┐ ржмрж┐рж╕рзНрждрж╛рж░рж┐рждржнрж╛ржмрзЗ Ubuntu VPS-ржП **MongoDB ржЗржирж╕рзНржЯрж▓, ржЗржЙржЬрж╛рж░ рждрзИрж░рж┐, ржбрж╛ржЯрж╛ржмрзЗрж╕ рждрзИрж░рж┐, ржЗржЙржЬрж╛рж░ ржУ ржбрж╛ржЯрж╛ржмрзЗрж╕ ржорзНржпрж╛ржирзЗржЬржорзЗржирзНржЯ, Firewall ржХржиржлрж┐ржЧрж╛рж░рзЗрж╢ржи, IP Access Control ржПржмржВ Automatic Backup** рж╕ржорзНржкрж░рзНржХрзЗ ржмрж▓ржмред

---

## **Step 1: MongoDB Install ржХрж░рж╛ (Locally)**

MongoDB ржЗржирж╕рзНржЯрж▓ ржХрж░рж╛рж░ ржЬржирзНржп ржирж┐ржЪрзЗрж░ ржХржорж╛ржирзНржбржЧрзБрж▓рзЛ рж░рж╛ржи ржХрж░рзБржи:

### **1. MongoDB-ржПрж░ Official GPG Key Add ржХрж░рзБржи**

MongoDB-ржПрж░ ржкрзНржпрж╛ржХрзЗржЬ ржнрзЗрж░рж┐ржлрж╛ржЗ ржХрж░рж╛рж░ ржЬржирзНржп ржПрж░ GPG key ржпрзБржХрзНржд ржХрж░рждрзЗ рж╣ржмрзЗред

```bash
curl -fsSL https://pgp.mongodb.com/server-7.0.asc | sudo gpg --dearmor -o /usr/share/keyrings/mongodb-server-7.0.gpg
```

### **2. MongoDB-ржПрж░ Official Repository ржпрзЛржЧ ржХрж░рзБржи**

```bash
echo "deb [signed-by=/usr/share/keyrings/mongodb-server-7.0.gpg] https://repo.mongodb.org/apt/ubuntu $(lsb_release -cs)/mongodb-org/7.0 multiverse" | sudo tee /etc/apt/sources.list.d/mongodb-org-7.0.list
```

### **3. System Update ржХрж░рзБржи**

```bash
sudo apt update
```

### **ржпржжрж┐ рждрзБржорж┐ oracular (Ubuntu 24.04 LTS) ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗ ржерж╛ржХрзЛ рждрж╛рж╣рж▓рзЗ ржПржЯрж┐ ржПржЦржирзЛ ржЕржлрж┐рж╕рж┐ржпрж╝рж╛рж▓ржнрж╛ржмрзЗ MongoDB 7.0 рж╕ржорж░рзНржержи ржХрж░ржЫрзЗ ржирж╛, рждрзБржорж┐ ржЖржЧрзЗрж░ Ubuntu 22.04 (jammy) ржХрзЛржбржирзЗржо ржмрзНржпржмрж╣рж╛рж░ ржХрж░рждрзЗ ржкрж╛рж░рзЛ:**

```bash
echo "deb [signed-by=/usr/share/keyrings/mongodb-server-7.0.gpg] https://repo.mongodb.org/apt/ubuntu jammy/mongodb-org/7.0 multiverse" | sudo tee /etc/apt/sources.list.d/mongodb-org-7.0.list
```

#### **System Update ржХрж░рзБржи**

```bash
sudo apt update
```

### **4. MongoDB Install ржХрж░рзБржи**

```bash
sudo apt install -y mongodb-org
```

### **5. MongoDB Service ржЪрж╛рж▓рзБ ржХрж░рзБржи**

```bash
sudo systemctl start mongod
```

### **6. MongoDB рж╕рж╛рж░рзНржнрж┐рж╕ ржЪрж╛рж▓рзБ ржерж╛ржХржмрзЗ ржирж┐рж╢рзНржЪрж┐ржд ржХрж░рзБржи**

```bash
sudo systemctl enable mongod
```

### **7. MongoDB ржЪрж╛рж▓рзБ рж╣рзЯрзЗржЫрзЗ ржХрж┐ржирж╛ ржЪрзЗржХ ржХрж░рзБржи**

```bash
sudo systemctl status mongod
```

ржпржжрж┐ рж╕ржм ржарж┐ржХ ржерж╛ржХрзЗ, рждрж╛рж╣рж▓рзЗ ржирж┐ржЪрзЗрж░ ржорждрзЛ ржорзЗрж╕рзЗржЬ ржжрзЗржЦрж╛ржмрзЗ:

```
тЧП mongod.service - MongoDB Database Server
     Loaded: loaded (/lib/systemd/system/mongod.service; enabled; vendor preset: enabled)
     Active: active (running) since...
```

ржПржЗ рж╕рзНржЯрзНржпрж╛ржЯрж╛рж╕ ржкрзЗрждрзЗ **q ржЪрж╛ржкрж▓рзЗ** ржЯрж╛рж░рзНржорж┐ржирж╛рж▓ ржерзЗржХрзЗ ржмрзЗрж░рж┐рзЯрзЗ ржЖрж╕ржмрзЗред

---

## **Step 2: MongoDB Shell-ржП ржврзЛржХрж╛**

MongoDB Shell ржЪрж╛рж▓рзБ ржХрж░рждрзЗ:

```bash
mongosh
```

ржПрждрзЗ MongoDB-ржПрж░ ржЗржирзНржЯрж╛рж░рзЗржХрзНржЯрж┐ржн ржХржирж╕рзЛрж▓ ржЪрж╛рж▓рзБ рж╣ржмрзЗред

---

## **Step 3: ржирждрзБржи Database рждрзИрж░рж┐ ржХрж░рж╛**

MongoDB рждрзЗ ржирждрзБржи ржбрж╛ржЯрж╛ржмрзЗрж╕ рждрзИрж░рж┐ ржХрж░рждрзЗ:

```javascript
use myDatabase
```

ржПржЯрж┐ `myDatabase` ржирж╛ржорзЗ ржПржХржЯрж┐ ржирждрзБржи ржбрж╛ржЯрж╛ржмрзЗрж╕ рждрзИрж░рж┐ ржХрж░ржмрзЗред рждржмрзЗ ржПржЯрж┐ рждржЦржиржЗ рж╕ржВрж░ржХрзНрж╖рж┐ржд рж╣ржмрзЗ ржпржЦржи ржЖржкржирж┐ ржПрждрзЗ ржбрж╛ржЯрж╛ ржпрзБржХрзНржд ржХрж░ржмрзЗржиред

ржбрж╛ржЯрж╛ржмрзЗрж╕рзЗ ржПржХржЯрж┐ ржХрж╛рж▓рзЗржХрж╢ржи (ржЯрзЗржмрж┐рж▓рзЗрж░ ржорждрзЛ) рждрзИрж░рж┐ ржХрж░рзБржи:

```javascript
db.myCollection.insertOne({ name: "Test Data" });
```

ржбрж╛ржЯрж╛ржмрзЗрж╕ рж▓рж┐рж╕рзНржЯ ржжрзЗржЦрждрзЗ:

```javascript
show dbs
```

---

## **Step 4: ржирждрзБржи User рждрзИрж░рж┐ ржХрж░рж╛ ржУ ржбрж╛ржЯрж╛ржмрзЗрж╕рзЗрж░ рж╕рж╛ржерзЗ рж╕ржВржпрзБржХрзНржд ржХрж░рж╛**

```javascript
use admin
db.createUser({
  user: "myUser",
  pwd: "myPassword",
  roles: [{ role: "readWrite", db: "myDatabase" }]
});
```

**ржЗржЙржЬрж╛рж░ рждрзИрж░рж┐ рж╣ржУрзЯрж╛рж░ ржкрж░ ржЪрзЗржХ ржХрж░рзБржи:**

```javascript
show users
```

---

## **Step 5: ржЗржЙржЬрж╛рж░рзЗрж░ ржкрж╛рж╕ржУрзЯрж╛рж░рзНржб ржкрж░рж┐ржмрж░рзНрждржи ржХрж░рж╛**

```javascript
use admin
db.updateUser("myUser", { pwd: "newSecurePassword" });
```

---

## **Step 6: User ржорзБржЫрзЗ ржлрзЗрж▓рж╛ (Delete)**

```javascript
use admin
db.dropUser("myUser")
```

---

## **Step 7: Database Rename ржХрж░рж╛ (MongoDB-рждрзЗ рж╕рж░рж╛рж╕рж░рж┐ Rename ржЕржкрж╢ржи ржирзЗржЗ)**

MongoDB-рждрзЗ ржбрж╛ржЯрж╛ржмрзЗрж╕ Rename ржХрж░рж╛рж░ ржХрзЛржирзЛ рж╕рж░рж╛рж╕рж░рж┐ ржХржорж╛ржирзНржб ржирзЗржЗред рждржмрзЗ, **ржирждрзБржи ржбрж╛ржЯрж╛ржмрзЗрж╕ рждрзИрж░рж┐ ржХрж░рзЗ ржкрзБрж░рж╛ржирзЛ ржбрж╛ржЯрж╛ржмрзЗрж╕ ржерзЗржХрзЗ ржбрж╛ржЯрж╛ ржХржкрж┐ ржХрж░рзЗ, ржкрж░рзЗ ржкрзБрж░рж╛ржирзЛржЯрж┐ ржбрж┐рж▓рж┐ржЯ ржХрж░рждрзЗ рж╣рзЯред**

**Database Rename ржХрж░рж╛рж░ ржкржжрзНржзрждрж┐:**

```bash
mongodump --db oldDatabase --out /backup/
mongorestore --db newDatabase /backup/oldDatabase/
```

---

## **Step 8: Database Delete ржХрж░рж╛**

MongoDB-рждрзЗ ржХрзЛржирзЛ ржбрж╛ржЯрж╛ржмрзЗрж╕ **ржбрж┐рж▓рж┐ржЯ ржХрж░рж╛рж░ ржЖржЧрзЗ рж╕рзЗржЯрж┐рждрзЗ ржврзБржХрждрзЗ рж╣ржмрзЗ**:

```javascript
use myDatabase
db.dropDatabase()
```

ржбрж╛ржЯрж╛ржмрзЗрж╕ ржбрж┐рж▓рж┐ржЯ рж╣рзЯрзЗ ржЧрзЗрж▓рзЗ `show dbs` ржХржорж╛ржирзНржб ржжрж┐рж▓рзЗ ржЖрж░ ржПржЯрж┐ ржжрзЗржЦрж╛ ржпрж╛ржмрзЗ ржирж╛ред

---

## **Step 9: MongoDB Restart, Stop ржУ Reload ржХрж░рж╛**

```bash
# MongoDB Restart
sudo systemctl restart mongod

# MongoDB Stop
sudo systemctl stop mongod

# MongoDB Start
sudo systemctl start mongod
```

---

## **рж╕ржмржХрж┐ржЫрзБ ржарж┐ржХржнрж╛ржмрзЗ ржХрж╛ржЬ ржХрж░ржЫрзЗ ржХрж┐ржирж╛ ржЪрзЗржХ ржХрж░рж╛**

```bash
mongosh
```

рждрж╛рж░ржкрж░ рж▓ржЧржЗржи ржХрж░рзЗ ржЪрзЗржХ ржХрж░рзБржи:

```javascript
use myDatabase
show collections
db.myCollection.find()
```

---

## **Step 10: ржирж┐рж░рзНржжрж┐рж╖рзНржЯ IP ржмрж╛ рж╕ржХрж▓ IP ржерзЗржХрзЗ Access ржжрзЗржУрзЯрж╛ (Firewall + Bind IP)**

MongoDB ржбрж┐ржлрж▓рзНржЯржнрж╛ржмрзЗ рж╢рзБржзрзБ рж▓рзЛржХрж╛рж▓рж╣рзЛрж╕рзНржЯ (`127.0.0.1`) ржерзЗржХрзЗ ржХрж╛ржирзЗржХрзНржЯ рж╣рждрзЗ ржкрж╛рж░рзЗред VPS-ржПрж░ ржмрж╛ржЗрж░рзЗрж░ ржХрзЛржирзЛ рж╕рж╛рж░рзНржнрж╛рж░ ржерзЗржХрзЗ ржЕрзНржпрж╛ржХрзНрж╕рзЗрж╕ ржжрж┐рждрзЗ рж╣рж▓рзЗ **bindIP ржкрж░рж┐ржмрж░рзНрждржи ржУ firewall ржХржиржлрж┐ржЧрж╛рж░ ржХрж░рждрзЗ рж╣ржмрзЗ**ред

### **1. MongoDB Config ржкрж░рж┐ржмрж░рзНрждржи ржХрж░рж╛ (Bind IP рж╕рзЗржЯ ржХрж░рж╛)**

ржлрж╛ржЗрж▓ ржУржкрзЗржи ржХрж░рзБржи:

```bash
sudo nano /etc/mongod.conf
```

ржирж┐ржЪрзЗрж░ ржЕржВрж╢ржЯрж┐ ржЦрзБржБржЬрзБржи:

```yaml
# network interfaces
net:
  bindIp: 127.0.0.1
```

**ржирж┐рж░рзНржжрж┐рж╖рзНржЯ IP ржерзЗржХрзЗ Access ржЕржирзБржорждрж┐ ржжрж┐рждрзЗ (ржпрзЗржоржи: `192.168.1.100`)**

```yaml
net:
  bindIp: 127.0.0.1,192.168.1.100
```

**рж╕ржХрж▓ IP ржерзЗржХрзЗ Access ржжрж┐рждрзЗ (тЪая╕П рж╕рж┐ржХрж┐ржЙрж░рж┐ржЯрж┐рж░ ржЬржирзНржп ржЭрзБржБржХрж┐ржкрзВрж░рзНржг)**

```yaml
net:
  bindIp: 0.0.0.0
```

ржкрж░рж┐ржмрж░рзНрждржи рж╕ржВрж░ржХрзНрж╖ржг ржХрж░рждрзЗ:
ЁЯСЙ **CTRL + X тЖТ Y тЖТ ENTER**

### **2. Firewall Rule ржпрзЛржЧ ржХрж░рж╛**

**ржирж┐рж░рзНржжрж┐рж╖рзНржЯ IP ржЕржирзБржорждрж┐ ржжрж┐рждрзЗ (192.168.1.100)**

```bash
sudo ufw allow from 192.168.1.100 to any port 27017
```

**рж╕ржХрж▓ IP ржХрзЗ Access ржжрж┐рждрзЗ (тЪая╕П ржирж┐рж░рж╛ржкржж ржирзЯ)**

```bash
sudo ufw allow 27017/tcp
```

---

## **Step 11: Firewall Enable ржУ Status ржЪрзЗржХ ржХрж░рж╛**

```bash
sudo ufw enable
sudo ufw status
```

MongoDB Firewall rule ржЪрзЗржХ ржХрж░рждрзЗ:

```bash
sudo ufw status numbered
```

---

## **рж╕ржВржХрзНрж╖рзЗржкрзЗ ржЧрзБрж░рзБрждрзНржмржкрзВрж░рзНржг ржХржорж╛ржирзНржбржЧрзБрж▓рзЛ**

| ржХрж╛ржЬ                 | ржХржорж╛ржирзНржб                                                                          |
| ------------------- | ------------------------------------------------------------------------------- |
| MongoDB Install     | `sudo apt install -y mongodb-org`                                               |
| MongoDB Start       | `sudo systemctl start mongod`                                                   |
| MongoDB Status      | `sudo systemctl status mongod`                                                  |
| MongoDB Shell Open  | `mongosh`                                                                       |
| ржирждрзБржи Database рждрзИрж░рж┐  | `use myDatabase`                                                                |
| ржирждрзБржи User рждрзИрж░рж┐      | `db.createUser({...})`                                                          |
| User Password Reset | `db.updateUser("user", {pwd: "newPass"})`                                       |
| Firewall Enable     | `sudo ufw enable`                                                               |
| ржирж┐рж░рзНржжрж┐рж╖рзНржЯ IP Allow  | `sudo ufw allow from 192.168.1.100 to any port 27017`                           |
| рж╕ржХрж▓ IP Allow        | `sudo ufw allow 27017/tcp`                                                      |
| Database Rename     | `mongodump --db oldDB --out /backup/ && mongorestore --db newDB /backup/oldDB/` |
| Database Delete     | `use myDatabase; db.dropDatabase()`                                             |

---

ржПржнрж╛ржмрзЗ ржЖржкржирж┐ **MongoDB рж╕рзЗржЯржЖржк, ржЗржЙржЬрж╛рж░ ржорзНржпрж╛ржирзЗржЬржорзЗржирзНржЯ, ржбрж╛ржЯрж╛ржмрзЗрж╕ ржорзНржпрж╛ржирзЗржЬржорзЗржирзНржЯ, ржПржмржВ Firewall ржХржиржлрж┐ржЧрж╛рж░рзЗрж╢ржи** ржХрж░рждрзЗ ржкрж╛рж░ржмрзЗржи! ЁЯЪА

<br />
<br />
<br />
<br />
<br />
<br />

# **MongoDB automatic backup** рж╕рзЗржЯржЖржк ржХрж░ржмрзЗржи ржХрзАржнрж╛ржмрзЗ ржПржмржВ **ржкрзНрж░рждрж┐ржжрж┐ржи рзи ржмрж╛рж░** ржмрзНржпрж╛ржХржЖржк ржирзЗржУрзЯрж╛рж░ ржмрзНржпржмрж╕рзНржерж╛ ржХрж░рж╛ред

---

## **Step 1: VPS-ржП рж▓ржЧржЗржи ржХрж░рзБржи**

ржкрзНрж░ржержорзЗ **VPS-ржПрж░ ржЯрж╛рж░рзНржорж┐ржирж╛рж▓ ржмрж╛ SSH** рждрзЗ рж▓ржЧржЗржи ржХрж░рзБржи:

```bash
ssh your_user@your_vps_ip
```

ржПржЦрж╛ржирзЗ:

- `your_user` = ржЖржкржирж╛рж░ VPS-ржПрж░ ржЗржЙржЬрж╛рж░ржирзЗржо
- `your_vps_ip` = ржЖржкржирж╛рж░ VPS-ржПрж░ IP Address

---

## **Step 2: ржмрзНржпрж╛ржХржЖржк рж╕ржВрж░ржХрзНрж╖ржгрзЗрж░ ржЬржирзНржп ржлрзЛрж▓рзНржбрж╛рж░ рждрзИрж░рж┐ ржХрж░рзБржи**

MongoDB-ржПрж░ ржмрзНржпрж╛ржХржЖржкржЧрзБрж▓рзЛ рж╕ржВрж░ржХрзНрж╖ржг ржХрж░рж╛рж░ ржЬржирзНржп ржПржХржЯрж┐ ржлрзЛрж▓рзНржбрж╛рж░ рждрзИрж░рж┐ ржХрж░рзБржи:

```bash
mkdir -p ~/mongodb_backups
```

ржПржЯрж┐ ржЖржкржирж╛рж░ **рж╣рзЛржо ржбрж┐рж░рзЗржХрзНржЯрж░рж┐рждрзЗ** `mongodb_backups` ржирж╛ржорзЗ ржПржХржЯрж┐ ржлрзЛрж▓рзНржбрж╛рж░ рждрзИрж░рж┐ ржХрж░ржмрзЗред

---

## **Step 3: ржмрзНржпрж╛ржХржЖржк рж╕рзНржХрзНрж░рж┐ржкрзНржЯ рждрзИрж░рж┐ ржХрж░рзБржи**

ржПржЦржи `backup.sh` ржирж╛ржорзЗ ржПржХржЯрж┐ рж╕рзНржХрзНрж░рж┐ржкрзНржЯ рждрзИрж░рж┐ ржХрж░рждрзЗ рж╣ржмрзЗред ржПржЗ ржлрж╛ржЗрж▓ржЯрж┐ ржмрзНржпрж╛ржХржЖржк ржирзЗржУрзЯрж╛рж░ ржХрж╛ржЬ ржХрж░ржмрзЗред

1. **nano editor** ржжрж┐рзЯрзЗ рж╕рзНржХрзНрж░рж┐ржкрзНржЯ рждрзИрж░рж┐ ржХрж░рзБржи:

   ```bash
   nano ~/backup.sh
   ```

2. ржлрж╛ржЗрж▓рзЗрж░ ржоржзрзНржпрзЗ ржирж┐ржЪрзЗрж░ ржХрзЛржб **copy-paste** ржХрж░рзБржи:

   ```bash
   #!/bin/bash

   # ржмрзНржпрж╛ржХржЖржкрзЗрж░ ржЬржирзНржп рждрж╛рж░рж┐ржЦ ржУ рж╕ржорзЯ ржпрзБржХрзНржд ржХрж░рж╛
   TIMESTAMP=$(date +"%F-%H-%M-%S")

   # MongoDB рж╕рзЗржЯржЖржк рждржерзНржп
   DB_NAME="your_database_name"   # ржЖржкржирж╛рж░ ржбрж╛ржЯрж╛ржмрзЗрж╕рзЗрж░ ржирж╛ржо ржжрж┐ржи
   BACKUP_DIR="/home/your_user/mongodb_backups"   # ржмрзНржпрж╛ржХржЖржк рж╕ржВрж░ржХрзНрж╖ржгрзЗрж░ рж▓рзЛржХрзЗрж╢ржи
   MONGO_HOST="localhost"
   MONGO_PORT="27017"

   # ржмрзНржпрж╛ржХржЖржк ржбрж┐рж░рзЗржХрзНржЯрж░рж┐ ржпржжрж┐ ржирж╛ ржерж╛ржХрзЗ, рждрж╛рж╣рж▓рзЗ рждрзИрж░рж┐ ржХрж░рзЛ
   mkdir -p "$BACKUP_DIR"

   # MongoDB ржбрж╛ржЯрж╛ржмрзЗрж╕ ржмрзНржпрж╛ржХржЖржк ржирзЗржУрзЯрж╛
   mongodump --host $MONGO_HOST --port $MONGO_PORT --db $DB_NAME --out "$BACKUP_DIR/$DB_NAME-$TIMESTAMP"

   # ржкрзБрж░ржирзЛ рзн ржжрж┐ржирзЗрж░ ржмрзНржпрж╛ржХржЖржк ржбрж┐рж▓рж┐ржЯ ржХрж░рж╛
   find "$BACKUP_DIR" -type d -mtime +7 -exec rm -rf {} \;

   echo "MongoDB backup completed at $TIMESTAMP"
   ```

   тЪая╕П **ржпрж╛ ржкрж░рж┐ржмрж░рзНрждржи ржХрж░ржмрзЗржи:**

   - `your_database_name` = ржЖржкржирж╛рж░ **MongoDB database name**
   - `your_user` = ржЖржкржирж╛рж░ VPS-ржПрж░ **username**

3. **ржлрж╛ржЗрж▓ржЯрж┐ рж╕ржВрж░ржХрзНрж╖ржг ржХрж░рзБржи:**
   - **Ctrl + X** ржЪрж╛ржкрзБржи
   - рждрж╛рж░ржкрж░ **Y** ржЪрж╛ржкрзБржи ржПржмржВ **Enter** ржжрж┐ржи
4. **ржпржжрж┐ рж╕ржорзНржкрзВрж░рзНржг Database рж╕ржВрж░ржХрзНрж╖ржг ржХрж░рждрзЗ ржЪрж╛ржи:**

   ```bash
   #!/bin/bash
   echo "Backup script started at $(date)" >> /root/erro_file_store/mongodb_backup.log
   # ржмрзНржпрж╛ржХржЖржкрзЗрж░ ржЬржирзНржп рждрж╛рж░рж┐ржЦ ржУ рж╕ржорзЯ ржпрзБржХрзНржд ржХрж░рж╛
   TIMESTAMP=$(date +"%F-%H-%M-%S")

    # MongoDB рж╕рзЗржЯржЖржк рждржерзНржп
    BACKUP_DIR="/home/root/mongodb_backups"   # ржмрзНржпрж╛ржХржЖржк рж╕ржВрж░ржХрзНрж╖ржгрзЗрж░ рж▓рзЛржХрзЗрж╢ржи
    MONGO_HOST="localhost"
    MONGO_PORT="27017"

    # ржмрзНржпрж╛ржХржЖржк ржбрж┐рж░рзЗржХрзНржЯрж░рж┐ ржпржжрж┐ ржирж╛ ржерж╛ржХрзЗ, рждрж╛рж╣рж▓рзЗ рждрзИрж░рж┐ ржХрж░рзЛ
    mkdir -p "$BACKUP_DIR"

    # MongoDB рж╕ржХрж▓ ржбрж╛ржЯрж╛ржмрзЗрж╕рзЗрж░ ржмрзНржпрж╛ржХржЖржк ржирзЗржУрзЯрж╛
    mongodump --host $MONGO_HOST --port $MONGO_PORT --out "$BACKUP_DIR/mongodb-backup-$>

    # Google Drive ржП ржмрзНржпрж╛ржХржЖржк ржЖржкрж▓рзЛржб ржХрж░рж╛ (rclone ржмрзНржпржмрж╣рж╛рж░)
    rclone copy "$BACKUP_DIR/mongodb-backup-$TIMESTAMP" gdrive:/mongodb_backups/ --log->

    # ржкрзБрж░ржирзЛ рзн ржжрж┐ржирзЗрж░ ржмрзНржпрж╛ржХржЖржк ржбрж┐рж▓рж┐ржЯ ржХрж░рж╛
    find "$BACKUP_DIR" -type d -mtime +7 -exec rm -rf {} \;

    echo "MongoDB backup completed at $TIMESTAMP and uploaded to Google Drive"

   ```


---

## **Step 4: рж╕рзНржХрзНрж░рж┐ржкрзНржЯржЯрж┐ ржПржХрзНрж╕рж┐ржХрж┐ржЙржЯрзЗржмрж▓ ржХрж░рзБржи**
ржПржЗ рж╕рзНржХрзНрж░рж┐ржкрзНржЯржЯрж┐ рж░рж╛ржи ржХрж░рж╛рж░ ржЬржирзНржп **ржПржХрзНрж╕рж┐ржХрж┐ржЙржЯрзЗржмрж▓ (Executable)** ржХрж░рждрзЗ рж╣ржмрзЗ:
```bash
chmod +x ~/backup.sh
````

---

## **Step 5: Cron Job рж╕рзЗржЯржЖржк ржХрж░рзБржи (ржкрзНрж░рждрж┐ржжрж┐ржи рзи ржмрж╛рж░ ржмрзНржпрж╛ржХржЖржк ржирзЗржУрзЯрж╛)**

ржПржЦржи, ржЖржорж░рж╛ **ржХрзНрж░ржиржЬржм (cron job)** рж╕рзЗржЯ ржХрж░ржм ржпрж╛рждрзЗ **ржкрзНрж░рждрж┐ржжрж┐ржи рзи ржмрж╛рж░ (рж╕ржХрж╛рж▓ рзоржЯрж╛ ржПржмржВ рж░рж╛ржд рзоржЯрж╛)** ржмрзНржпрж╛ржХржЖржк ржирзЗрзЯред

1. ржХрзНрж░ржиржЬржм ржПржбрж┐ржЯрж░ ржЦрзБрж▓рзБржи:

   ```bash
   crontab -e
   ```

2. ржирж┐ржЪрзЗрж░ рж▓рж╛ржЗржиржЯрж┐ ржпрзЛржЧ ржХрж░рзБржи:

   ```bash
   0 8 * * * /home/your_user/backup.sh >> /home/your_user/backup.log 2>&1
   0 20 * * * /home/your_user/backup.sh >> /home/your_user/backup.log 2>&1
   ```

   **ржмрзНржпрж╛ржЦрзНржпрж╛:**

   - `0 8 * * *` тЖТ **ржкрзНрж░рждрж┐ржжрж┐ржи рж╕ржХрж╛рж▓ рзоржЯрж╛рзЯ ржмрзНржпрж╛ржХржЖржк ржирж┐ржмрзЗ**
   - `0 20 * * *` тЖТ **ржкрзНрж░рждрж┐ржжрж┐ржи рж░рж╛ржд рзоржЯрж╛рзЯ ржмрзНржпрж╛ржХржЖржк ржирж┐ржмрзЗ**
   - `backup.log` тЖТ ржмрзНржпрж╛ржХржЖржкрзЗрж░ **рж▓ржЧ (log) ржлрж╛ржЗрж▓** рждрзИрж░рж┐ рж╣ржмрзЗ, ржпрзЗржЦрж╛ржирзЗ ржмрзНржпрж╛ржХржЖржк ржирзЗржУрзЯрж╛рж░ рж░рзЗржХрж░рзНржб ржерж╛ржХржмрзЗред

3. **Ctrl + X** ржЪрж╛ржкрзБржи, рждрж╛рж░ржкрж░ **Y** ржЪрж╛ржкрзБржи ржПржмржВ **Enter** ржжрж┐ржиред

---

## **Step 6: ржорзНржпрж╛ржирзБрзЯрж╛рж▓рж┐ ржмрзНржпрж╛ржХржЖржк ржкрж░рзАржХрзНрж╖рж╛ ржХрж░рзБржи**

ржХрзНрж░ржиржЬржм ржХрж╛ржЬ ржХрж░ржЫрзЗ ржХрж┐ржирж╛ рждрж╛ ржирж┐рж╢рзНржЪрж┐ржд ржХрж░рждрзЗ **ржорзНржпрж╛ржирзБрзЯрж╛рж▓рж┐** рж╕рзНржХрзНрж░рж┐ржкрзНржЯ ржЪрж╛рж▓рж╛ржи:

```bash
~/backup.sh
```

рждрж╛рж░ржкрж░, ржЪрзЗржХ ржХрж░рзБржи ржмрзНржпрж╛ржХржЖржк ржлрзЛрж▓рзНржбрж╛рж░рзЗ ржлрж╛ржЗрж▓ рждрзИрж░рж┐ рж╣рзЯрзЗржЫрзЗ ржХрж┐ржирж╛:

```bash
ls -lah ~/mongodb_backups
```

ржпржжрж┐ рж╕ржм ржарж┐ржХ ржерж╛ржХрзЗ, рждрж╛рж╣рж▓рзЗ ржжрзЗржЦржмрзЗржи ржПржХржЯрж┐ ржирждрзБржи ржмрзНржпрж╛ржХржЖржк ржлрзЛрж▓рзНржбрж╛рж░ рждрзИрж░рж┐ рж╣рзЯрзЗржЫрзЗред

---

## **Step 7: ржмрзНржпрж╛ржХржЖржк ржлрж╛ржЗрж▓ ржбрж╛ржЙржирж▓рзЛржб / рж░рж┐рж╕рзНржЯрзЛрж░ ржХрж░рж╛рж░ ржкржжрзНржзрждрж┐**

### **тЬЕ ржмрзНржпрж╛ржХржЖржк ржлрж╛ржЗрж▓ ржбрж╛ржЙржирж▓рзЛржб ржХрж░рж╛ (VPS ржерзЗржХрзЗ ржирж┐ржЬрзЗрж░ ржХржорзНржкрж┐ржЙржЯрж╛рж░рзЗ)**

ржЖржкржирж┐ **scp** ржХржорж╛ржирзНржб ржжрж┐рзЯрзЗ ржмрзНржпрж╛ржХржЖржк ржлрж╛ржЗрж▓ ржбрж╛ржЙржирж▓рзЛржб ржХрж░рждрзЗ ржкрж╛рж░рзЗржи:

```bash
scp -r your_user@your_vps_ip:/home/your_user/mongodb_backups ./
```

ржПржЯрж┐ **ржЖржкржирж╛рж░ рж▓рзЛржХрж╛рж▓ ржкрж┐рж╕рж┐рждрзЗ** `mongodb_backups` ржлрзЛрж▓рзНржбрж╛рж░ржЯрж┐ ржбрж╛ржЙржирж▓рзЛржб ржХрж░ржмрзЗред

---

### **тЬЕ MongoDB ржмрзНржпрж╛ржХржЖржк рж░рж┐рж╕рзНржЯрзЛрж░ ржХрж░рж╛ (Restore Database from Backup)**

ржмрзНржпрж╛ржХржЖржк ржерзЗржХрзЗ **ржбрж╛ржЯрж╛ржмрзЗрж╕ рж░рж┐рж╕рзНржЯрзЛрж░** ржХрж░рждрзЗ ржЪрж╛ржЗрж▓рзЗ ржПржЗ ржХржорж╛ржирзНржб ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзБржи:

```bash
mongorestore --db your_database_name /home/your_user/mongodb_backups/backup_folder_name/
```

ржПржЦрж╛ржирзЗ `backup_folder_name` ржкрж░рж┐ржмрж░рзНрждржи ржХрж░рзЗ ржЖржкржирж╛рж░ ржирж┐рж░рзНржжрж┐рж╖рзНржЯ ржмрзНржпрж╛ржХржЖржк ржлрзЛрж▓рзНржбрж╛рж░рзЗрж░ ржирж╛ржо ржжрж┐ржиред

---

## **NOTE**

ржПржЦржи ржЖржкржирж╛рж░ **MongoDB automatic backup system** **рж╕ржлрж▓ржнрж╛ржмрзЗ рж╕рзЗржЯржЖржк** ржХрж░рж╛ рж╣рзЯрзЗ ржЧрзЗржЫрзЗ! ржкрзНрж░рждрж┐ржжрж┐ржи **рж╕ржХрж╛рж▓ рзоржЯрж╛ ржУ рж░рж╛ржд рзоржЯрж╛**-рждрзЗ VPS **ржЕржЯрзЛржорзЗржЯрж┐ржХ MongoDB ржмрзНржпрж╛ржХржЖржк** ржирж┐рзЯрзЗ рж╕ржВрж░ржХрзНрж╖ржг ржХрж░ржмрзЗ ржПржмржВ ржкрзБрж░ржирзЛ **рзн ржжрж┐ржирзЗрж░ ржмрзНржпрж╛ржХржЖржк ржорзБржЫрзЗ ржлрзЗрж▓ржмрзЗред** тд╡

<br />
<br />
<br />
<br />
<br />

# **Google Drive-ржП MongoDB Backup ржЕржЯрзЛржорзЗржЯрж┐ржХ ржЖржкрж▓рзЛржб**

ржЖржкржирж╛рж░ VPS-ржП MongoDB ржмрзНржпрж╛ржХржЖржк ржЧрзБржЧрж▓ ржбрзНрж░рж╛ржЗржнрзЗ **ржЕржЯрзЛржорзЗржЯрж┐ржХ** ржЖржкрж▓рзЛржб ржХрж░рждрзЗ **rclone** ржмрзНржпржмрж╣рж╛рж░ ржХрж░рж╛ рж╣ржмрзЗред

---

### **Step 1: VPS-ржП rclone ржЗржирзНрж╕ржЯрж▓ ржХрж░рзБржи**

VPS-ржПрж░ ржЯрж╛рж░рзНржорж┐ржирж╛рж▓рзЗ ржирж┐ржЪрзЗрж░ ржХржорж╛ржирзНржб ржжрж┐ржи:

```bash
curl https://rclone.org/install.sh | sudo bash
```

ржПржЯрж┐ **rclone** ржЗржирзНрж╕ржЯрж▓ ржХрж░ржмрзЗред

---

### **Step 2: rclone ржХржиржлрж┐ржЧрж╛рж░ ржХрж░рзБржи (Google Drive ржПржХрж╛ржЙржирзНржЯ ржпрзБржХрзНржд ржХрж░рзБржи)**

```bash
rclone config
```

ржПрж░ржкрж░ ржзрж╛ржкрзЗ ржзрж╛ржкрзЗ ржЕржирзБрж╕рж░ржг ржХрж░рзБржи:

1. ржирждрзБржи ржХржиржлрж┐ржЧрж╛рж░ рждрзИрж░рж┐ ржХрж░рзБржи:

   - `n` ржЪрж╛ржкрзБржи (New remote)
   - ржирж╛ржо ржжрж┐ржи: `gdrive`

2. Google Drive ржирж┐рж░рзНржмрж╛ржЪржи ржХрж░рзБржи:

   - `Storage type` ржЪрж╛ржмрзЗ, рж╕рзЗржЦрж╛ржирзЗ `drive` ржЯрж╛ржЗржк ржХрж░рзБржи

3. **Client ID & Secret ржПржирзНржЯрж╛рж░ ржХрж░рж╛ рж▓рж╛ржЧржмрзЗ ржирж╛**, рж╢рзБржзрзБ **Enter** ржЪрж╛ржкрзБржи

4. **Authentication Method**:

   - **Full access ржжрж┐рждрзЗ** `1` ржЪрж╛ржкрзБржи

5. **Google Drive Authorization:**
   - VPS-ржПрж░ **ржмрзНрж░рж╛ржЙржЬрж╛рж░ ржирж╛ ржерж╛ржХрж▓рзЗ**, ржЖржкржирж╛ржХрзЗ ржПржХржЯрж╛ **рж▓рж┐ржВржХ ржжрзЗржмрзЗ**
   - **рж▓рж┐ржВржХ ржУржкрзЗржи ржХрж░рзЗ** ржЖржкржирж╛рж░ **Google Account** ржжрж┐рзЯрзЗ рж▓ржЧржЗржи ржХрж░рзБржи
   - **Authentication ржХрзЛржб ржХржкрж┐ ржХрж░рзЗ** VPS-ржПрж░ ржЯрж╛рж░рзНржорж┐ржирж╛рж▓рзЗ ржкрзЗрж╕рзНржЯ ржХрж░рзБржи

---

Link ржЯрж╛ ржПржоржи рж╣ржмрзЗ

```
http://127.0.0.1:53682/?state=VQ99iErCu78A8OCLfTHXjg&code=4/0AQSTgQEhhRZ8gaPYFtM3teE_71FhKXF0iPn6DEUyiUn5h_sHtfLtUiVQyY1Iy0MwhyWxXw&scope=https://www.googleapis.com/auth/drive
```

---

6. рж╕рзЗржЯрж┐ржВрж╕ рж╕рзЗржн ржХрж░рзБржи:
   - `y` ржЪрж╛ржкрзБржи (Yes)

---

### **Step 3: ржмрзНржпрж╛ржХржЖржк рж╕рзНржХрзНрж░рж┐ржкрзНржЯрзЗ Google Drive ржЖржкрж▓рзЛржб ржпрзБржХрзНржд ржХрж░рзБржи**

`backup.sh` ржлрж╛ржЗрж▓ ржЦрзБрж▓рзБржи:

```bash
nano ~/backup.sh
```

ржирж┐ржЪрзЗрж░ рж▓рж╛ржЗржиржЯрж┐ рж╕рзНржХрзНрж░рж┐ржкрзНржЯрзЗрж░ **рж╢рзЗрж╖рзЗ** ржпрзБржХрзНржд ржХрж░рзБржи:

```bash
rclone copy "$BACKUP_DIR" gdrive:MongoDB_Backups
```

ржПржЯрж┐ ржЖржкржирж╛рж░ ржмрзНржпрж╛ржХржЖржк ржлрж╛ржЗрж▓ **Google Drive-ржПрж░ "MongoDB_Backups" ржлрзЛрж▓рзНржбрж╛рж░рзЗ** ржЖржкрж▓рзЛржб ржХрж░ржмрзЗред

---

### **Step 4: ржорзНржпрж╛ржирзБрзЯрж╛рж▓рж┐ ржЖржкрж▓рзЛржб ржкрж░рзАржХрзНрж╖рж╛ ржХрж░рзБржи**

```bash
./backup.sh
```

рждрж╛рж░ржкрж░ Google Drive-ржП **MongoDB_Backups** ржлрзЛрж▓рзНржбрж╛рж░рзЗ ржЧрж┐рзЯрзЗ ржжрзЗржЦрзБржи ржлрж╛ржЗрж▓ ржПрж╕рзЗржЫрзЗ ржХрж┐ржирж╛ред

---

### **Step 5: Cron Job ржЖржкржбрзЗржЯ ржХрж░рзБржи (Auto Upload)**

```bash
crontab -e
```

ржирж┐ржЪрзЗрж░ рж▓рж╛ржЗржиржЯрж┐ ржпрзЛржЧ ржХрж░рзБржи:

```bash
0 8 * * * /home/your_user/backup.sh >> /home/your_user/backup.log 2>&1
0 20 * * * /home/your_user/backup.sh >> /home/your_user/backup.log 2>&1
```

ржПрждрзЗ **ржкрзНрж░рждрж┐ржжрж┐ржи рзи ржмрж╛рж░** ржмрзНржпрж╛ржХржЖржк ржирж┐рзЯрзЗ **Google Drive-ржП ржЖржкрж▓рзЛржб** рж╣ржмрзЗред

---

<br />
<br />
<br />
<br />

# **AWS S3-рждрзЗ MongoDB Backup ржЖржкрж▓рзЛржб ржХрж░рж╛**

AWS S3-рждрзЗ MongoDB ржмрзНржпрж╛ржХржЖржк ржЖржкрж▓рзЛржб ржХрж░рж╛рж░ ржЬржирзНржп **AWS CLI** ржмрзНржпржмрж╣рж╛рж░ ржХрж░ржмрзЛред

---

### **Step 1: AWS CLI ржЗржирзНрж╕ржЯрж▓ ржХрж░рзБржи**

VPS-ржПрж░ ржЯрж╛рж░рзНржорж┐ржирж╛рж▓рзЗ рж░рж╛ржи ржХрж░рзБржи:

```bash
sudo apt update && sudo apt install awscli -y
```

---

### **Step 2: AWS Credentials рж╕рзЗржЯржЖржк ржХрж░рзБржи**

```bash
aws configure
```

ржПржЦржи **AWS Access Key & Secret Key ржжрж┐ржи** (ржЖржкржирж╛рж░ AWS IAM Console ржерзЗржХрзЗ ржирж┐рждрзЗ рж╣ржмрзЗ)ред

- Access Key: `your_aws_access_key`
- Secret Key: `your_aws_secret_key`
- Region: `ap-southeast-1` (ржмрж╛ржВрж▓рж╛ржжрзЗрж╢рзЗрж░ ржЬржирзНржп Singapore)
- Output Format: `json`

---

### **Step 3: S3-рждрзЗ ржмрзНржпрж╛ржХржЖржк ржЖржкрж▓рзЛржб ржпрзБржХрзНржд ржХрж░рзБржи**

`backup.sh` рж╕рзНржХрзНрж░рж┐ржкрзНржЯ ржЖржкржбрзЗржЯ ржХрж░рзБржи:

```bash
nano ~/backup.sh
```

ржирж┐ржЪрзЗрж░ рж▓рж╛ржЗржиржЯрж┐ рж╕рзНржХрзНрж░рж┐ржкрзНржЯрзЗрж░ **рж╢рзЗрж╖рзЗ** ржпрзБржХрзНржд ржХрж░рзБржи:

```bash
aws s3 cp --recursive "$BACKUP_DIR" s3://your-bucket-name/mongodb_backups/
```

тЪая╕П **your-bucket-name** ржкрж░рж┐ржмрж░рзНрждржи ржХрж░рзЗ **ржЖржкржирж╛рж░ S3 bucket name ржжрж┐ржи**ред

---

### **Step 4: ржорзНржпрж╛ржирзБрзЯрж╛рж▓рж┐ ржЖржкрж▓рзЛржб ржкрж░рзАржХрзНрж╖рж╛ ржХрж░рзБржи**

```bash
./backup.sh
```

рждрж╛рж░ржкрж░ **AWS S3 console**-ржП ржЧрж┐рзЯрзЗ ржЪрзЗржХ ржХрж░рзБржи, ржмрзНржпрж╛ржХржЖржк ржлрж╛ржЗрж▓ ржЖржкрж▓рзЛржб рж╣рзЯрзЗржЫрзЗ ржХрж┐ржирж╛ред

---

### **Step 5: Cron Job ржЖржкржбрзЗржЯ ржХрж░рзБржи (Auto Upload to S3)**

```bash
crontab -e
```

ржирж┐ржЪрзЗрж░ рж▓рж╛ржЗржиржЯрж┐ ржпрзЛржЧ ржХрж░рзБржи:

```bash
0 8 * * * /home/your_user/backup.sh >> /home/your_user/backup.log 2>&1
0 20 * * * /home/your_user/backup.sh >> /home/your_user/backup.log 2>&1
```

ржПрждрзЗ **ржкрзНрж░рждрж┐ржжрж┐ржи рзи ржмрж╛рж░** ржмрзНржпрж╛ржХржЖржк ржирж┐рзЯрзЗ **AWS S3-рждрзЗ ржЖржкрж▓рзЛржб** рж╣ржмрзЗред

---

## **Final Result:**

тЬЕ MongoDB-ржПрж░ ржмрзНржпрж╛ржХржЖржк **VPS-ржП рж╕ржВрж░ржХрзНрж╖ржг** рж╣ржмрзЗ  
тЬЕ **Google Drive / AWS S3**-рждрзЗ **Auto Upload** рж╣ржмрзЗ  
тЬЕ ржкрзБрж░ржирзЛ **рзн ржжрж┐ржирзЗрж░ ржмрзНржпрж╛ржХржЖржк ржЕржЯрзЛржорзЗржЯрж┐ржХ ржбрж┐рж▓рж┐ржЯ** рж╣ржмрзЗ

---
